<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Vue 2 Audio Player GitHub</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5 }
    .audio-player { width: 100%; max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.08) }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0 }
    button { padding: 8px 12px; cursor: pointer; border: 1px solid #ddd; background: #fafafa; border-radius: 4px }
    button:hover { background: #eee }
    .status { min-height: 20px; margin-bottom: 10px }
    .error { color: red }
    .transcript { max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; font-size: 14px; border-radius: 4px; background: #fafafa }
    .transcript .active { background: #e0e0e0 }
  </style>
</head>
<body>

<div id="app">
  <div class="audio-player">
    <audio 
      ref="audio" 
      :src="audioUrl" 
      controls 
      crossorigin="anonymous"
      @timeupdate="updateTime"
      @loadedmetadata="onLoaded"
      @error="onError"
    >
      <track kind="subtitles" srclang="fr" label="FR" :src="vttUrl" default>
    </audio>

    <div class="controls">
      <button @click="rewind">-15s</button>
      <button @click="togglePlay">{{ isPlaying ? 'Pause' : 'Lecture' }}</button>
      <button @click="forward">+15s</button>
      <button @click="toggleTranscript">{{ showTranscript ? 'Masquer transcription' : 'Afficher transcription' }}</button>
    </div>

    <div class="status">
      <div v-if="error" class="error">{{ error }}</div>
    </div>

    <div v-if="showTranscript" class="transcript">
      <div 
        v-for="(cue,index) in cues" 
        :key="index"
        :class="{ active: currentTime >= cue.start && currentTime <= cue.end }"
      >
        {{ cue.text }}
      </div>
    </div>
  </div>
</div>

<script>
new Vue({
  el: '#app',
  data() {
    return {
      audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
      vttUrl: 'example.vtt',
      isPlaying: false,
      showTranscript: false,
      cues: [],
      currentTime: 0,
      error: null
    }
  },
  mounted() {
    this.loadCues()
  },
  methods: {
    togglePlay() {
      const audio = this.$refs.audio

      if ( !audio ) 
      {
        return
      } 
      else 
      {
        if ( this.isPlaying ) 
        {
          audio.pause()
        } 
        else 
        {
          audio.play().catch(() => 
          {
            this.error = 'Lecture bloquée par le navigateur'
          })
        }

        this.isPlaying = !this.isPlaying
      }
    },
    rewind() {
      const audio = this.$refs.audio

      if ( audio ) 
      {
        audio.currentTime = Math.max(0, audio.currentTime - 15)
      } 
      else 
      {
        return
      }
    },
    forward() {
      const audio = this.$refs.audio

      if ( audio ) 
      {
        audio.currentTime = audio.currentTime + 15
      } 
      else 
      {
        return
      }
    },
    updateTime() {
      const audio = this.$refs.audio

      if ( audio ) 
      {
        this.currentTime = audio.currentTime
      } 
      else 
      {
        return
      }
    },
    onLoaded() 
    {
      this.error = null
    },
    onError() 
    {
      this.error = 'Erreur de lecture (réseau ou format invalide)'
    },
    toggleTranscript() 
    {
      this.showTranscript = !this.showTranscript
    },
    loadCues() 
    {
      const audio = this.$refs.audio

      if ( !audio ) 
      {
        return
      } 
      else 
      {
        const tracks = audio.textTracks

        if ( !tracks || !tracks.length ) 
        {
          return
        } 
        else 
        {
          const track = tracks[0]
          track.mode = 'hidden'

          const tryLoad = () => 
          {
            if ( track.cues && track.cues.length ) 
            {
              this.cues = Array.from(track.cues).map(cue => 
              {
                return { start: cue.startTime, end: cue.endTime, text: cue.text }
              })
            } else {
              setTimeout(tryLoad, 300)
            }
          }
          tryLoad()
        }
      }
    }
  }
})
</script>

</body>
</html>
